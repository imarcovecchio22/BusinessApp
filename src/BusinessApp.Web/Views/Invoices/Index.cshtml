@model List<InvoiceDto>
@{ ViewData["Title"] = "Facturas"; }
<div class="page-header"><div class="d-flex justify-content-between align-items-center"><div><h1><i class="bi bi-receipt"></i> Facturas</h1></div><div><a asp-action="Create" class="btn btn-primary"><i class="bi bi-plus-circle"></i> Nueva Factura</a></div></div></div>
<div class="card mb-3"><div class="card-body"><form asp-action="Index" method="get" class="row g-3">
<div class="col-md-3"><label>Buscar</label><input type="text" name="searchTerm" class="form-control" placeholder="Número..." value="@ViewBag.SearchTerm"/></div>
<div class="col-md-3"><label>Cliente</label><select name="customerId" class="form-select" asp-items="ViewBag.Customers"><option value="">Todos</option></select></div>
<div class="col-md-2"><label>Estado</label><select name="status" class="form-select"><option value="">Todos</option><option value="1">Borrador</option><option value="2">Emitida</option><option value="3">Pagada</option><option value="4">Cancelada</option><option value="5">Vencida</option></select></div>
<div class="col-md-2"><label>Desde</label><input type="date" name="fromDate" class="form-control" value="@ViewBag.FromDate"/></div>
<div class="col-md-2 d-flex align-items-end"><button type="submit" class="btn btn-primary w-100"><i class="bi bi-search"></i></button></div>
</form></div></div>
<div class="card"><div class="card-body">
@if(Model.Any()){<div class="table-responsive"><table class="table table-hover align-middle"><thead><tr><th>Número</th><th>Cliente</th><th>Fecha</th><th>Total</th><th>Estado</th><th>Acciones</th></tr></thead><tbody>
@foreach(var inv in Model){
var statusColor = inv.Status == InvoiceStatus.Paid ? "success" : inv.Status == InvoiceStatus.Issued ? "primary" : inv.Status == InvoiceStatus.Cancelled ? "danger" : "secondary";
<tr><td><strong>@inv.InvoiceNumber</strong></td><td>@inv.CustomerName</td><td>@inv.InvoiceDate.ToString("dd/MM/yyyy")</td>
<td><strong>$@inv.Total.ToString("N2")</strong>@if(inv.PaidAmount > 0 && !inv.IsPaid){<br><small class="text-success">Pagado: $@inv.PaidAmount.ToString("N2")</small>}</td>
<td><span class="badge bg-@statusColor">@inv.StatusName</span>@if(inv.IsOverdue){<br><span class="badge bg-danger mt-1">Vencida</span>}</td>
<td><div class="btn-group btn-group-sm"><a asp-action="Details" asp-route-id="@inv.Id" class="btn btn-outline-info"><i class="bi bi-eye"></i></a><a asp-action="Pdf" asp-route-id="@inv.Id" class="btn btn-outline-secondary"><i class="bi bi-file-pdf"></i></a></div></td></tr>
}</tbody></table></div>}else{<div class="text-center py-5"><i class="bi bi-inbox" style="font-size:4rem;color:#ccc"></i><p class="text-muted mt-3">No hay facturas</p><a asp-action="Create" class="btn btn-primary mt-2"><i class="bi bi-plus"></i> Crear Primera Factura</a></div>}
</div></div>
